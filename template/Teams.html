<!DOCTYPE HTML>
<!--
	Hyperspace by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>
	<head>
		<title>StT - Teams Panel</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
	</head>
	<body class="is-preload">
		<!-- Header -->
		<header id="header">
			<a href="index.html" class="title">Teams</a>
			<nav>
				<ul id="LinksList">
				</ul>
			</nav>
			<script src="assets/js/jquery.min.js"></script>
				<script>
					$(document).ready(function(){
						if(!localStorage.getItem('TeamsSort')){
							localStorage.setItem('TeamsSort', "Score")
							$("#TeamsList").html(`<button type="button" id="SortChance" onclick="SortChance()">Trustfactor</button>`);
							
						}
						var stoken = sessionStorage.getItem('token')
						if(!stoken){
							var TokenStore = localStorage.getItem('token');
							if(!TokenStore){
								createHTML();
								document.getElementById("logout").innerHTML = "Ausgeloged";
							}else{
								check(TokenStore).then(function(status) { //MUSS PROMISSE Wenn localStorage einen Token hat prüfen, wenn invalid login
									if(status.status){
										createHTML(status.rights)
										document.getElementById("logout").innerHTML = "Ausloggen";
									}else{
										localStorage.removeItem('token');
										createHTML();
										document.getElementById("logout").innerHTML = "Ausgeloged";
									}
								});
							}
						}else{
							check(stoken).then(function(status) { //MUSS PROMISSE Wenn sessionStorage einen Token hat prüfen, wenn invalid login
								if(status.status){
									createHTML(status.rights)
									document.getElementById("logout").innerHTML = "Ausloggen";
								}else{
									sessionStorage.removeItem('token');
									createHTML();
									document.getElementById("logout").innerHTML = "Ausgeloged";
								}
							});
						}

						runEventAbfrage();

						function runEventAbfrage() {
							if(sessionStorage.getItem('token')){
								var Token = sessionStorage.getItem('token')
							}else if(localStorage.getItem('token')){
								var Token = localStorage.getItem('token');
							}else{
								var Token = "No Token"
							}
							var posting = $.get("REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/api/v1/Teams/currentEvents", {
								Token: Token
							});
								posting.done(function(data) {
									console.log(data)
									var TableString =``

									data.eventlist.map(Events => {
										let BothTimes = "";
										Events.event_times.map(Time => {
											BothTimes = `${BothTimes}<button type="button" id="SetEvent" onclick="SetEvent('${Time}')">${humanReadable(Time)}</button> `
										});
										TableString = `${TableString}${BothTimes}`
									});

									$("#EventSelector").html("<h2>Zukünftige Events</h2>" + TableString + "<br><br>");
								});

								posting.fail(function(err) {
									if(err.status === 403){
										$("#TeamsList").html("Nicht genügend Rechte!");
										$('#TeamsList').addClass("highlight");
										setTimeout(function () {
											$('#TeamsList').removeClass('highlight');
										}, 2000);
									}else if(err.status === 503){
										alert("Kritischer Fehler!")
									}
								});
		
						}

						function humanReadable(time) {
							let JStime = new Date(time*1000);
							return JStime.toLocaleString().slice(0, -6) + " Uhr";;
							
						}

						//Functions for Check Permissions and create Header
						function check(Token) {
							return new Promise(function(resolve, reject) {
								var posting = $.post("REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/api/v1/Login/check", {
									Token: Token
								});
								posting.done(function(data) {
									resolve({status: true, loginname: data.loginname, rights: data.rights});
								});
								posting.fail(function(err) {
									resolve({status: false});
								});
		
							});
						}
		
						function createHTML(rights) {
							var HeaderHTML = "";
								HeaderHTML += `<li><a href="index.html">Login</a></li>`
								if(rights){
									if(rights.includes("TeamRead")){ HeaderHTML += `<li><a href="Teams.html" class="active">Teams</a></li>` }
									if(rights.includes("TrustRead")){ HeaderHTML += `<li><a href="TrustFactor.html">Clashscore</a></li>` }
									//if(rights.includes("ReadUser")){ HeaderHTML += `<li><a href="ModifyUser.html">Benutzerverwaltung</a></li>` }
								}
								HeaderHTML += `<li><p id="logout" onclick="logout()">Ausloggen</p></li>`
							$("#LinksList").html(HeaderHTML);
						}
					});
				</script>
				<script>
					function logout() {
						var stoken = sessionStorage.getItem('token')
						if(!stoken){
							var TokenStore = localStorage.getItem('token');
							if(!TokenStore){
								document.getElementById("logout").innerHTML = "Ausgeloged";
							}else{
								Requestlogout(TokenStore).then(function(status) { //MUSS PROMISSE Wenn localStorage einen Token hat prüfen, wenn invalid login
									if(status.status){
										document.getElementById("logout").innerHTML = "Ausgeloged";
										createHTML();
										$('#result').html(`Bitte logge dich ein.`);
									}else{
										createHTML();
										document.getElementById("logout").innerHTML = "Ausloggen";
									}
								});
							}
						}else{
							Requestlogout(stoken).then(function(status) { //MUSS PROMISSE Wenn localStorage einen Token hat prüfen, wenn invalid login
									if(status.status){
										document.getElementById("logout").innerHTML = "Ausgeloged";
										createHTML();
										$('#result').html(`Bitte logge dich ein.`);
									}else{
										createHTML();
										document.getElementById("logout").innerHTML = "Ausloggen";
									}
								});
						}
	
						function Requestlogout(Token) {
						return new Promise(function(resolve, reject) {
							var posting = $.post("REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/api/v1/Login/logout", {
								Token: Token
							});
							posting.done(function(data) {
								resolve({status: true});
							});
							posting.fail(function(err) {
								resolve({status: false});
							});
	
						});
						}
	
						function createHTML(rights) {
							var HeaderHTML = "";
								HeaderHTML += `<li><a href="index.html">Login</a></li>`
								if(rights){
									if(rights.includes("TeamRead")){ HeaderHTML += `<li><a href="Teams.html" class="active">Teams</a></li>` }
									if(rights.includes("TrustRead")){ HeaderHTML += `<li><a href="TrustFactor.html">Clashscore</a></li>` }
									//if(rights.includes("ReadUser")){ HeaderHTML += `<li><a href="ModifyUser.html">Benutzerverwaltung</a></li>` }
								}
								HeaderHTML += `<li><p id="logout" onclick="logout()">Ausloggen</p></li>`
							$("#LinksList").html(HeaderHTML);
						}
					}
					</script>
		</header>
		<!-- Anmeldungsliste -->
		<section id="Liste" class="wrapper style3 fade-up">
			<div class="inner">
				<div id="EventSelector"></div>
				<h2 id="NoPermissions"></h2>
				<div id="TeamsList"></div>
				<div id="TeamsListSort"></div>
			</div>
		</section>

		<!-- ZusammengestelltesTeam -->
		<section id="Events" class="wrapper style2-alt fade-up">
			<div class="inner">
				<h2>Team:</h2>
				<p>Liste der aktuellen Spielerauswahl</p>
				<div id="TeamSpielerListe">
				</div>
			</div>
		</section>

		<!-- Footer -->
		<footer id="footer" class="wrapper style1-alt">
			<div class="inner">
				<ul class="menu">
					<li>&copy; Untitled. All rights reserved.</li><li>Design: <a href="REPLACE_THIS_WITH_BACKEND_PROTOKOL://html5up.net">HTML5 UP</a></li><li>Creator: <a href="https://github.com/BolverBlitz">BolverBlitz</a></li><li>Projekt: <a href="https://github.com/EBG-PW/Endegs-AnlagenMonitor">Github</a></li><li>Impressum und Datenschutz: <a href="REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/lawstuff">Hier</a></li>
				</ul>
			</div>
		</footer>

		<!-- Scripts -->
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			<script>
				function SetEvent(time) {
					localStorage.setItem('EventTime', time)
					localStorage.setItem('TeamsMemberCount', "0")		
					localStorage.setItem('TeamsMemberList', "")		
					createEventPlayerList();
				}

				function createEventPlayerList() {
					var EventTime = localStorage.getItem('EventTime')
					if(sessionStorage.getItem('token')){
						var Token = sessionStorage.getItem('token')
					}else if(localStorage.getItem('token')){
						var Token = localStorage.getItem('token');
					}else{
						var Token = "No Token"
					}

					var posting = $.get("REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/api/v1/Teams/EventMembers", {
						Token: Token,
						EventTime: EventTime
					});
					posting.done(function(data) {
						var TableHead = `<thead><tr><th>Bild</th><th>Username</th><th>Clashscore</th><th>Rank</th><th>Lanes</th></tr></thead>`
						var TableString =`<div class="table-wrapper"><table>${TableHead}`
						var TableEnd = `</table></div>`;

						if(localStorage.getItem('TeamsSort') === "Score"){
									data.Memberlist.sort((a, b) => (a.trustfactor > b.trustfactor) ? -1 : 1)
									$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Trustfactor</button>`);
								}else{
									data.Memberlist.sort(function(a, b){
										var nameA=a.summonerName.toLowerCase(), nameB=b.summonerName.toLowerCase();
										if (nameA < nameB) //sort string ascending
										return -1;
										if (nameA > nameB)
										return 1;
										return 0; //default return value (no sorting)
									});
									$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Alphabetisch</button>`);
								}

						data.Memberlist.map(Member => {
							Member.discord_id = `n${Member.discord_id}` //Convert Big Int to String for better handling...
							let BothTimes = "";
							let LanesString = "";

							if(Member.sup === true){
								if(Member.main === "TOP"){
									LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
								}else{
									LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
								}
							}else{
								LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
							}
							if(Member.jgl === true){
								if(Member.main === "JGL"){
									LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
								}else{
									LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
							}
							}else{
								LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
							}
							if(Member.mid === true){
								if(Member.main === "MID"){
									LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
								}else{
									LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
								}
							}else{
								LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
							}
							if(Member.adc === true){
								if(Member.main === "ADC"){
									LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
								}else{
									LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
								}
							}else{
								LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
							}
							if(Member.sup === true){
								if(Member.main === "SUP"){
									LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
								}else{
									LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
								}
							}else{
								LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
							}

							BothTimes = `${BothTimes}<tbody><tr><td><img src="https://geodragon.geozukunft.at/dragontail-10.23.1/10.23.1/img/profileicon/${Member.profileIconId}.png" height=40 width=40></td></img><td>${Member.summonerName}</td><td>${Member.trustfactor}</td><td><div style="color: ${GetRankColor(Member.rank)} !important;">${Member.rank}</div></td><td>${LanesString}</td>`
							TableString = `${TableString}${BothTimes}`
							
						});

						$("#TeamsList").html(`<h2>Angemeldete Spieler für ${humanReadable(localStorage.getItem('EventTime'))}</h2>${TableString}<br><br>`);
					});

					posting.fail(function(err) {
						if(err.status === 403){
							$("#TeamsList").html("Nicht genügend Rechte!");
							$('#TeamsList').addClass("highlight");
							setTimeout(function () {
								$('#TeamsList').removeClass('highlight');
							}, 2000);
						}else if(err.status === 503){
							alert("Kritischer Fehler!")
						}
					});

					//Functions
					function humanReadable(time) {
						let JStime = new Date(time*1000);
						return JStime.toLocaleString().slice(0, -6) + " Uhr";;
							
					}

					function GetRankColor(rank) {
						if(rank.includes("Iron")){
							return "#a19d94";
						}else if(rank.includes("Bronze")){
							return "#b08d57";
						}else if(rank.includes("Silver")){
							return "#C0C0C0";
						}else if(rank.includes("Gold")){
							return "#CFB53B";
						}else if(rank.includes("Platinum")){
							return "#6699ff";
						}else if(rank.includes("Diamond")){
							return "#b9f2ff";
						}else if(rank.includes("Grandmaster")){
							return "#8B0000";
						}else if(rank.includes("Master")){
							return "#6a0dad";
						}else if(rank.includes("Challenger")){
							return "#E0FFFF";
						}else if(rank.includes("Gott")){
							return "#cc3300";
						}else{
							return "#000000"
						}
					}
				}
			</script>

			<script>
				function SortChance() {
					if(localStorage.getItem('TeamsSort') === "Score"){
						localStorage.setItem('TeamsSort', "Alphabetisch")
						createEventPlayerList()
						$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Alphabetisch</button>`);
					}else{
						localStorage.setItem('TeamsSort', "Score")
						createEventPlayerList()
						$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Trustfactor</button>`);
					}
					
					function createEventPlayerList() {
					var EventTime = localStorage.getItem('EventTime')
					if(sessionStorage.getItem('token')){
						var Token = sessionStorage.getItem('token')
					}else if(localStorage.getItem('token')){
						var Token = localStorage.getItem('token');
					}else{
						var Token = "No Token"
					}

					var posting = $.get("REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/api/v1/Teams/EventMembers", {
									Token: Token,
									EventTime: EventTime
									});
								posting.done(function(data) {
									var TableHead = `<thead><tr><th>Bild</th><th>Username</th><th>Clashscore</th><th>Rank</th><th>Lanes</th></tr></thead>`
									var TableString =`<div class="table-wrapper"><table>${TableHead}`
									var TableEnd = `</table></div>`;

									if(localStorage.getItem('TeamsSort') === "Score"){
												data.Memberlist.sort((a, b) => (a.trustfactor > b.trustfactor) ? -1 : 1)
												$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Trustfactor</button>`);
											}else{
												data.Memberlist.sort(function(a, b){
													var nameA=a.summonerName.toLowerCase(), nameB=b.summonerName.toLowerCase();
													if (nameA < nameB) //sort string ascending
													return -1;
													if (nameA > nameB)
													return 1;
													return 0; //default return value (no sorting)
												});
												$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Alphabetisch</button>`);
											}

									data.Memberlist.map(Member => {
										Member.discord_id = `n${Member.discord_id}` //Convert Big Int to String for better handling...
									});

									let ListArray = localStorage.getItem('TeamsMemberList').split(",");
									ListArray.map(MemberList => {
										MemberList = MemberList.split(".");
										var Pointer = -1;
										data.Memberlist.map(Member => {
											Pointer = Pointer + 1
										if(Member.discord_id === MemberList[1]){
											data.Memberlist.splice(Pointer, 1);
										}
									});

									});
									data.Memberlist.map(Member => {
										//Member.discord_id = `n${Member.discord_id}` //Convert Big Int to String for better handling...
										let BothTimes = "";
										let LanesString = "";

										if(Member.sup === true){
											if(Member.main === "TOP"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
										}
										if(Member.jgl === true){
											if(Member.main === "JGL"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
										}
										if(Member.mid === true){
											if(Member.main === "MID"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
										}
										if(Member.adc === true){
											if(Member.main === "ADC"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
										}
										if(Member.sup === true){
											if(Member.main === "SUP"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
										}

										BothTimes = `${BothTimes}<tbody><tr><td><img src="https://geodragon.geozukunft.at/dragontail-10.23.1/10.23.1/img/profileicon/${Member.profileIconId}.png" height=40 width=40></td></img><td>${Member.summonerName}</td><td>${Member.trustfactor}</td><td><div style="color: ${GetRankColor(Member.rank)} !important;">${Member.rank}</div></td><td>${LanesString}</td>`
										TableString = `${TableString}${BothTimes}`
										
									});

									$("#TeamsList").html(`<h2>Angemeldete Spieler für ${humanReadable(localStorage.getItem('EventTime'))}</h2>${TableString}<br><br>`);
								});

								posting.fail(function(err) {
									if(err.status === 403){
										$("#TeamsList").html("Nicht genügend Rechte!");
										$('#TeamsList').addClass("highlight");
										setTimeout(function () {
											$('#TeamsList').removeClass('highlight');
										}, 2000);
									}else if(err.status === 503){
										alert("Kritischer Fehler!");
									}
								});

								//Functions
								function humanReadable(time) {
										let JStime = new Date(time*1000);
										return JStime.toLocaleString().slice(0, -6) + " Uhr";
										
								}

								function GetRankColor(rank) {
									if(rank.includes("Iron")){
										return "#a19d94";
									}else if(rank.includes("Bronze")){
										return "#b08d57";
									}else if(rank.includes("Silver")){
										return "#C0C0C0";
									}else if(rank.includes("Gold")){
										return "#CFB53B";
									}else if(rank.includes("Platinum")){
										return "#6699ff";
									}else if(rank.includes("Diamond")){
										return "#b9f2ff";
									}else if(rank.includes("Grandmaster")){
										return "#8B0000";
									}else if(rank.includes("Master")){
										return "#6a0dad";
									}else if(rank.includes("Challenger")){
										return "#E0FFFF";
									}else if(rank.includes("Gott")){
										return "#cc3300";
									}else{
										return "#000000"
									}
								}
					}
				}
			</script>

			<script>
				function AddToTeam({ discordID, iconID, lane, name, trustfactor, rank }) {

					let TeamEinsStore = localStorage.getItem('TeamsMemberCount')
					if(TeamEinsStore > 0){
						var MemberListArray = localStorage.getItem('TeamsMemberList').split(",")
						var isDuplicate = false;
						MemberListArray.map(Member => {
							Member = Member.split(".")
							if(Member[1] === discordID){
								isDuplicate = true;
							}
						});
						if(!isDuplicate){
							localStorage.setItem('TeamsMemberCount', Number(localStorage.getItem('TeamsMemberCount')) + 1)
							localStorage.setItem('TeamsMemberList', `${localStorage.getItem('TeamsMemberList')}${getTeamID(localStorage.getItem('TeamsMemberCount'))}.${discordID}.${iconID}.${lane}.${name}.${trustfactor}.${rank},`)
						}
						//console.log(localStorage.getItem('TeamsMemberList'))
						createEventPlayerList();
					}else{
						localStorage.setItem('TeamsMemberCount', Number(localStorage.getItem('TeamsMemberCount')) + 1)
						localStorage.setItem('TeamsMemberList', `${getTeamID(localStorage.getItem('TeamsMemberCount'))}.${discordID}.${iconID}.${lane}.${name}.${trustfactor}.${rank},`)
						createEventPlayerList();
					}
				}

				function RemoveFromTeam(discordID){
					let ListArray = localStorage.getItem('TeamsMemberList').split(",");
					let MemberPointer = 0
					ListArray.map(MemberList => {
						MemberList = MemberList.split(".");
						//console.log(MemberList)
						if(MemberList[1] === discordID){
							ListArray.splice(MemberPointer, 1)
						}
						MemberPointer = MemberPointer + 1;
					});
					localStorage.setItem('TeamsMemberList', saveArrayToString(ListArray))
					localStorage.setItem('TeamsMemberCount', Number(localStorage.getItem('TeamsMemberCount')) - 1)
					createEventPlayerList();
				}
					
					//console.log(discordID, iconID, lane, name, trustfactor)

					//Recreate Tables...
					function createEventPlayerList() {
					var EventTime = localStorage.getItem('EventTime')
					if(sessionStorage.getItem('token')){
						var Token = sessionStorage.getItem('token')
					}else if(localStorage.getItem('token')){
						var Token = localStorage.getItem('token');
					}else{
						var Token = "No Token"
					}

					var posting = $.get("REPLACE_THIS_WITH_BACKEND_PROTOKOL://REPLACE_THIS_WITH_BACKEND_IP:REPLACE_THIS_WITH_BACKEND_PORT/api/v1/Teams/EventMembers", {
									Token: Token,
									EventTime: EventTime
									});
								posting.done(function(data) {
									var TableHead = `<thead><tr><th>Bild</th><th>Username</th><th>Clashscore</th><th>Rank</th><th>Lanes</th></tr></thead>`
									var TableString =`<div class="table-wrapper"><table>${TableHead}`
									var TableEnd = `</table></div>`;

									if(localStorage.getItem('TeamsSort') === "Score"){
												data.Memberlist.sort((a, b) => (a.trustfactor > b.trustfactor) ? -1 : 1)
												$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Trustfactor</button>`);
											}else{
												data.Memberlist.sort(function(a, b){
													var nameA=a.summonerName.toLowerCase(), nameB=b.summonerName.toLowerCase();
													if (nameA < nameB) //sort string ascending
													return -1;
													if (nameA > nameB)
													return 1;
													return 0; //default return value (no sorting)
												});
												$("#TeamsListSort").html(`<button type="button" id="SortChance" onclick="SortChance()">Alphabetisch</button>`);
											}
									data.Memberlist.map(Member => {
										Member.discord_id = `n${Member.discord_id}` //Convert Big Int to String for better handling...
									});

									let ListArray = localStorage.getItem('TeamsMemberList').split(",");

									/* Table Var for Teams Table below main Table */
									var TeamsTableHead = `<thead><tr><th>Bild</th><th>Username</th><th>Clashscore</th><th>Rank</th><th>Lane</th><th>Actions</th></tr></thead>`
									var TeamsTableString =`<div id="TeamsTable0" class="table-wrapper"><table>${TeamsTableHead}`
									var TeamsTableEnd = `</table></div>`;
									var TeamsTableMember = "<p>Team 1:</p>";
									var TeamPointer = 0; //Var um Team änderungen im Array zu finden um die Tabelle abzuschließen
									var TLPointer = 0; //Track Teamleader
									var isTL = false;
									ListArray.map(MemberList => {
										MemberList = MemberList.split(".");
										var Pointer = -1;
										data.Memberlist.map(Member => {
											Pointer = Pointer + 1
											if(Member.discord_id === MemberList[1]){
												data.Memberlist.splice(Pointer, 1);
											}
										});
										if(Number(TLPointer) === Number(MemberList[0])){
											TLPointer++
											isTL = true
										}
										if(MemberList.length > 1){
											if(Number(TeamPointer) === Number(MemberList[0])){
												var UPDownButtons = "";
												if(TeamPointer === 0){
													//Nur hoch pfeil
												}
												var Buttons = `<buttonb type="button" style="color: #ff0000 !important;" onclick="RemoveFromTeam('${MemberList[1]}')">X</buttonb>`
												if(isTL){
													Buttons = `${Buttons}  TeamLead`
													isTL = false
												}
												TeamsTableMember = `${TeamsTableMember}<tbody><tr><td><img src="https://geodragon.geozukunft.at/dragontail-10.23.1/10.23.1/img/profileicon/${MemberList[2]}.png" height=40 width=40></td></img><td>${MemberList[4]}</td><td>${MemberList[5]}</td><td><div style="color: ${GetRankColor(MemberList[6])} !important;">${MemberList[6]}</div></td><td>${MemberList[3]}</td><td>${Buttons}</td>`
											}else{
												TeamPointer = TeamPointer + 1;
												var Buttons = `<buttonb type="button" style="color: #ff0000 !important;" onclick="RemoveFromTeam('${MemberList[1]}')">X</buttonb>`
												if(isTL){
													Buttons = `${Buttons}  TeamLead`
													isTL = false
												}
												var FirstTableMember = `<tbody><tr><td><img src="https://geodragon.geozukunft.at/dragontail-10.23.1/10.23.1/img/profileicon/${MemberList[2]}.png" height=40 width=40></td></img><td>${MemberList[4]}</td><td>${MemberList[5]}</td><td><div style="color: ${GetRankColor(MemberList[6])} !important;">${MemberList[6]}</div></td><td>${MemberList[3]}</td><td>${Buttons}</td>`
												
												var TeamsTableStringAppend =`<div id="TeamsTable${TeamPointer} class="table-wrapper"><table>${TeamsTableHead}`
												
													TeamsTableMember = `${TeamsTableMember}${TeamsTableEnd}<br><br><p>Team ${TeamPointer+1}:</p>${TeamsTableStringAppend}${FirstTableMember}`
											}
										}

									});
									TeamsTableString = `${TeamsTableString}${TeamsTableMember}`

									data.Memberlist.map(Member => {
										//Member.discord_id = `n${Member.discord_id}` //Convert Big Int to String for better handling...
										let BothTimes = "";
										let LanesString = "";

										if(Member.sup === true){
											if(Member.main === "TOP"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="top" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'top'})">TOP</buttonb> | `
										}
										if(Member.jgl === true){
											if(Member.main === "JGL"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="jgl" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'jgl'})">JGL</buttonb> | `
										}
										if(Member.mid === true){
											if(Member.main === "MID"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="mid" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'mid'})">MID</buttonb> | `
										}
										if(Member.adc === true){
											if(Member.main === "ADC"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="adc" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'adc'})">ADC</buttonb> | `
										}
										if(Member.sup === true){
											if(Member.main === "SUP"){
												LanesString = `${LanesString}<buttonb type="button" style="color: #00ff22 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
											}else{
												LanesString = `${LanesString}<buttonb type="button" style="color: #f6fa00 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
											}
										}else{
											LanesString = `${LanesString}<buttonb type="button" style="color: #808080 !important;" id="sup" onclick="AddToTeam({iconID: '${Member.profileIconId}', trustfactor: '${Member.trustfactor}', name: '${Member.summonerName}', discordID: '${Member.discord_id}', rank: '${Member.rank}', lane: 'sup'})">SUP</buttonb>`
										}

										BothTimes = `${BothTimes}<tbody><tr><td><img src="https://geodragon.geozukunft.at/dragontail-10.23.1/10.23.1/img/profileicon/${Member.profileIconId}.png" height=40 width=40></td></img><td>${Member.summonerName}</td><td>${Member.trustfactor}</td><td><div style="color: ${GetRankColor(Member.rank)} !important;">${Member.rank}</div></td><td>${LanesString}</td>`
										TableString = `${TableString}${BothTimes}`
										
									});

									$("#TeamsList").html(`<h2>Angemeldete Spieler für ${humanReadable(localStorage.getItem('EventTime'))}</h2>${TableString}<br><br>`);
									$("#TeamSpielerListe").html(`${TeamsTableString}`);

									
								});

								posting.fail(function(err) {
									if(err.status === 403){
										$("#TeamsList").html("Nicht genügend Rechte!");
										$('#TeamsList').addClass("highlight");
										setTimeout(function () {
											$('#TeamsList').removeClass('highlight');
										}, 2000);
									}else if(err.status === 503){
										alert("Kritischer Fehler!");
									}
								});

								//Functions
								function humanReadable(time) {
										let JStime = new Date(time*1000);
										return JStime.toLocaleString().slice(0, -6) + " Uhr";
										
								}

								function GetRankColor(rank) {
									if(rank.includes("Iron")){
										return "#a19d94";
									}else if(rank.includes("Bronze")){
										return "#b08d57";
									}else if(rank.includes("Silver")){
										return "#C0C0C0";
									}else if(rank.includes("Gold")){
										return "#CFB53B";
									}else if(rank.includes("Platinum")){
										return "#6699ff";
									}else if(rank.includes("Diamond")){
										return "#b9f2ff";
									}else if(rank.includes("Grandmaster")){
										return "#8B0000";
									}else if(rank.includes("Master")){
										return "#6a0dad";
									}else if(rank.includes("Challenger")){
										return "#E0FFFF";
									}else if(rank.includes("Gott")){
										return "#cc3300";
									}else{
										return "#000000"
									}
								}
					}

				//Helper Funktions
				function getTeamID(MemberCount) {
					let Zahl = Math.floor((MemberCount/5)-0.1)
					return Zahl;
				}

				function saveArrayToString(arr) {
					var out = "";
					arr.map(Member => {
						Member = Member.split(".")
						console.log(Member.length > 0, Member.length)
						if(Member.length > 1){
							out = `${out}${Member[0]}.${Member[1]}.${Member[2]}.${Member[3]}.${Member[4]}.${Member[5]}.${Member[6]},`
						}
					});
					return out;
				}

				function sortDataArrayByTeam(arr) {
					console.log(arr[0].charAt(0))
					arr.sort((a, b) => (a.charAt(0) > b.charAt(0)) ? 1 : -1)
					return arr;
				}
			</script>
	</body>
</html>